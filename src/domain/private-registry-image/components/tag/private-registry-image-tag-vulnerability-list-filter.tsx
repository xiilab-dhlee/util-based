"use client";

import { useAtomValue } from "jotai";
import { useParams } from "next/navigation";
import { Button } from "xiilab-ui";

import { useGetPrivateRegistryImageTagVulnerabilities } from "@/domain/private-registry-image/hooks/use-get-private-registry-image-tag-vulnerabilities";
import {
  openPrivateRegistryImageTagLogModalAtom,
  privateRegistryImageTagVulnerabilityPageAtom,
} from "@/domain/private-registry-image/state/private-registry-image.atom";
import { MySearchFilter } from "@/shared/components/layouts/search-filter";
import { LIST_PAGE_SIZE } from "@/shared/constants/core.constant";
import { useGlobalModal } from "@/shared/hooks/use-global-modal";

/**
 * 내부 레지스트리 이미지 태그 취약점 목록 페이지 상단 필터 컴포넌트
 *
 * 내부 레지스트리 이미지 태그 취약점 목록 페이지에서 검색어를 필터링하는 기능을 제공합니다.
 *
 * @returns 내부 레지스트리 이미지 태그 취약점 목록 페이지 상단 필터 컴포넌트
 */
export function PrivateRegistryImageTagVulnerabilityListFilter() {
  const { id, tagId } = useParams();

  const page = useAtomValue(privateRegistryImageTagVulnerabilityPageAtom);

  const { onOpen } = useGlobalModal(openPrivateRegistryImageTagLogModalAtom);

  const handleLog = () => {
    onOpen();
  };

  const { data } = useGetPrivateRegistryImageTagVulnerabilities({
    page,
    size: LIST_PAGE_SIZE,
    imageId: Number(id),
    tagId: Number(tagId),
  });

  return (
    <MySearchFilter title="취약점 목록" total={data?.totalSize}>
      <Button
        width={100}
        height={30}
        variant="gradient"
        color="primary"
        icon="SourceCode"
        iconSize={18}
        iconPosition="left"
        onClick={handleLog}
      >
        로그 보기
      </Button>
    </MySearchFilter>
  );
}
